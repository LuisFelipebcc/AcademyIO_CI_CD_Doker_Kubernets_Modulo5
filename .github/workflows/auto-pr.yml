name: Create Pull Request

on:
  push:
    branches:
      - "feature/**"
      - "fix/**"
      - "hotfix/**"

permissions:
  pull-requests: write
  contents: read

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create Pull Request
        uses: actions/github-script@v7
        with:
          script: |
            const branch = context.ref.replace('refs/heads/', '');
            const title = `${branch}: automated PR`;

            // Check if PR already exists
            const prs = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              head: `${context.repo.owner}:${branch}`
            });

            if (prs.data.length > 0) {
              console.log('PR already exists');
              return;
            }

            // Create PR
            await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              head: branch,
              base: 'main',
              body: `## Automated PR for branch: \`${branch}\`\n\nThis PR was created automatically.\nMerge when CI checks pass âœ…`
            });

            console.log(`PR created for branch: ${branch}`);
