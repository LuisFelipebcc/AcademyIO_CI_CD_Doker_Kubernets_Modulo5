name: Create Pull Request

on:
  push:
    branches:
      - "feature/**"
      - "fix/**"
      - "hotfix/**"

permissions:
  contents: read

jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create Pull Request
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: ${{ github.ref_name }}
        run: |
          # Check if PR already exists
          existing_pr=$(gh pr list --head "$BRANCH" --base main --json number --jq .[0].number 2>/dev/null || echo "")

          if [ -n "$existing_pr" ]; then
            echo "PR already exists: #$existing_pr"
            exit 0
          fi

          # Create new PR
          gh pr create \
            --head "$BRANCH" \
            --base main \
            --title "$BRANCH: automated PR" \
            --body "## Automated PR for branch: \`$BRANCH\`

            This PR was created automatically by GitHub Actions.

            When all CI checks pass âœ…, this PR can be merged to main.
                        " || echo "Failed to create PR (may already exist)"
